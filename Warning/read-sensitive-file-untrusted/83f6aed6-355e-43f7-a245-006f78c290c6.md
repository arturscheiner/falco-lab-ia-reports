# Report: Sensitive File Access by Non-Trusted Program
=====================================================

### Overview

This report details an alert generated by Falco, a system monitoring and alerting tool. The alert indicates that a non-trusted program accessed a sensitive file (/etc/shadow) for reading on the host k8s-worker-01.

### Alert Details

The attached JSON attachment contains the following relevant information:

| Key | Value |
| --- | --- |
| `output` | `20:48:31.955306916: Warning Sensitive file opened for reading by non-trusted program (file=/etc/shadow gparent=systemd ggparent=<NA> gggparent=<NA> evt_type=openat user=root user_uid=0 user_loginuid=-1 process=cat proc_exepath=/bin/cat parent=containerd-shim command=cat /etc/shadow terminal=34816 container_id=d2d430b34bdd container_image=docker.io/library/busybox container_image_tag=latest container_name=ping-pod k8s_ns=default k8s_pod_name=ping-pod)` |
| `priority` | `Warning` |

### Mitigation Strategies

To mitigate this behavior, the following command line and configuration suggestions are proposed:

#### 1. Update Docker Configuration

To prevent sensitive files from being accessed by non-trusted containers in the future, you can update your Docker configuration to exclude `/etc/shadow` from being mounted as a volume.

Add the following lines to your `docker-compose.yml` or equivalent file:
```yml
version: '3'

services:
  # ...
  containerd-shim:
    volumes:
      - /etc/shadow:/etc/shadow:ro
```
This will mount `/etc/shadow` only for reading, preventing it from being accessed by non-trusted containers.

#### 2. Implement Filesystem Access Controls

To further restrict access to sensitive files, consider implementing filesystem access controls using a tool like `seccomp`.

Create a new file (e.g., `/etc/seccomp/discard.sh`) containing the following rules:
```bash
# Discard openat requests on /etc/shadow
load_rule -F '/etc/shadow'
```
Load the new seccomp profile:
```bash
sudo set seccomp 'discard.sh'
```
This will discard any openat requests that attempt to access `/etc/shadow` for writing.

#### 3. Monitor and Alert

Keep a close eye on your host's activity logs to detect any similar incidents. Configure Falco to send alerts when sensitive files are accessed by non-trusted programs, ensuring swift detection and response times.

Example Falco configuration:
```yml
rules:
- id: sensitive-file-access
  source: syscall.openat
  filter:
    fields: file.path == "/etc/shadow"
    gparent != "systemd"
    ggparent != "<NA>"
    gggparent != "<NA>"
  trigger:
    level: warning
    log: "Error: Sensitive file accessed by non-trusted program"
```
These steps will help mitigate the behavior observed in the alert, ensuring the security and integrity of sensitive files on your host.

### Conclusion

This report has outlined a potential vulnerability in your system's configuration, where a non-trusted program accessed a sensitive file for reading. By implementing the suggested mitigation strategies, you can prevent similar incidents from occurring in the future.